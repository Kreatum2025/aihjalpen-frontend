function waitForEl(e,t,o){return window.Utils&&"function"==typeof window.Utils.waitForEl?window.Utils.waitForEl(e,t,o):Promise.resolve(document.querySelector(e))}function handleSendClick(e){e.preventDefault(),e.stopPropagation(),"function"==typeof window.sendKonradMessage&&window.sendKonradMessage()}window.Utils=window.Utils||{showFormMessage:(e,t="success")=>{try{const o=document.querySelector("[data-form-message]");if(o)return o.textContent=e,o.setAttribute("data-type",t),void(o.hidden=!1)}catch(e){}console.warn("[UI]",t,e)}},window.addEventListener("beforeunload",function(){window.Utils&&"function"==typeof window.Utils.handleBeforeUnloadSafe&&window.Utils.handleBeforeUnloadSafe()},{capture:!0});let _chatEventsWired=!1;const FLOATING_CHAT_HANDLED_BY_KONRAD=!0;document.addEventListener("DOMContentLoaded",function(){if(window.Utils&&window.Utils.initDarkMode(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(e){"auto"!==localStorage.getItem("theme")&&localStorage.getItem("theme")||(e.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"))}),window.__AIH_MENU_INIT__)return;window.__AIH_MENU_INIT__=!0,function(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".mobile-menu"),o=document.querySelector(".mobile-menu-close");function n(){t&&(t.classList.remove("active"),document.body.classList.remove("menu-open"),document.body.style.overflow=""),e&&e.setAttribute("aria-expanded","false")}e&&t&&e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),t.classList.contains("active")?n():(t&&(t.classList.add("active"),document.body.classList.add("menu-open"),document.body.style.overflow="hidden"),e&&e.setAttribute("aria-expanded","true"))}),o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),n()});document.querySelectorAll(".mobile-nav-link").forEach(e=>{e.addEventListener("click",e=>{setTimeout(()=>{n()},100)})});const r=document.querySelectorAll(".mobile-acc-trigger");r.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const o="true"===e.getAttribute("aria-expanded"),n=e.getAttribute("aria-controls"),i=document.getElementById(n);r.forEach(t=>{if(t!==e){t.setAttribute("aria-expanded","false");const e=t.getAttribute("aria-controls"),o=document.getElementById(e);o&&o.setAttribute("hidden","")}}),i&&(o?(e.setAttribute("aria-expanded","false"),i.setAttribute("hidden","")):(e.setAttribute("aria-expanded","true"),i.removeAttribute("hidden")))})});document.querySelectorAll(".mobile-nav-sublink").forEach(e=>{e.addEventListener("click",e=>{setTimeout(()=>{n()},100)})}),t&&document.addEventListener("click",o=>{!t.classList.contains("active")||t.contains(o.target)||e.contains(o.target)||n()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t&&t.classList.contains("active")&&n()});const i=document.querySelector('.mobile-nav-sublink[aria-current="page"]');if(i){const e=i.closest(".mobile-acc-panel");if(e){const t=document.querySelector(`.mobile-acc-trigger[aria-controls="${e.id}"]`);t&&(t.setAttribute("aria-expanded","true"),e.removeAttribute("hidden"))}}}();document.querySelectorAll(".nav-dropdown > a, .dropdown-trigger").forEach(e=>{e.addEventListener("click",t=>{if(window.innerWidth>=768){t.preventDefault();const o=e.closest(".nav-dropdown"),n=o?.querySelector(".dropdown-menu");if(n){const e=n.classList.contains("show");document.querySelectorAll(".dropdown-menu.show").forEach(e=>{e!==n&&e.classList.remove("show")}),n.classList.toggle("show",!e)}}})}),document.addEventListener("click",e=>{e.target.closest(".nav-dropdown")||document.querySelectorAll(".dropdown-menu.show").forEach(e=>{e.classList.remove("show")})}),window.Modals&&(window.Modals.initServiceModals(),window.Modals.initPricingModals());try{window.Chat&&"function"==typeof window.Chat.initChat&&window.Chat.initChat()}catch(e){console.warn("Chat initialization failed:",e)}const e=(t=5)=>{"function"==typeof window.openKonradModal&&"function"==typeof window.closeKonradModal&&"function"==typeof window.sendKonradMessage?(async()=>{if(!_chatEventsWired)try{const e=document.querySelector("#konrad-chat-button");e&&e.addEventListener("click",()=>window.openKonradModal?.());const t=await waitForEl(".konrad-close-btn").catch(()=>null),o=await waitForEl("#konrad-send-button").catch(()=>null),n=await waitForEl("#gdpr-link-in-chat").catch(()=>null);let r=0;const i=e=>{e.preventDefault(),e.stopPropagation(),"function"==typeof closeKonradModal&&closeKonradModal()},a=e=>{e.preventDefault(),e.stopPropagation(),"function"==typeof showGdprModal&&showGdprModal()};t&&!t.dataset.chatWired&&(t.addEventListener("click",i),t.dataset.chatWired="true",r++),o&&!o.dataset.chatWired&&(o.addEventListener("click",handleSendClick),o.dataset.chatWired="true",r++),n&&!n.dataset.chatWired&&(n.addEventListener("click",a),n.dataset.chatWired="true",r++),_chatEventsWired=!0}catch(e){console.warn("Chat wire-up error:",e.message)}})():t>0&&setTimeout(()=>e(t-1),100)};e();const t=document.getElementById("modal-contact-btn");if(t&&t.addEventListener("click",function(){const e=document.getElementById("kontakt");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),document.addEventListener("click",function(e){const t=document.getElementById("chatbot-popup"),o=document.getElementById("chatbot-icon");!t||!t.classList.contains("active")||t.contains(e.target)||o&&o.contains(e.target)||t.classList.remove("active")}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href"),o=t&&"#"!==t?document.querySelector(t):null;o&&o.scrollIntoView({behavior:"smooth",block:"start"})})}),function(){try{var e=(location.pathname||"").toLowerCase();if(!new Set(["/","/index.html","/aeo-optimering.html"]).has(e))return void(window.__CONTACT_FORM_DISABLED__=!0);var t=document.querySelector("form.contact-form");if(!t)return void(window.__CONTACT_FORM_DISABLED__=!0);if("1"===t.dataset.bound)return void(window.__CONTACT_FORM_DISABLED__=!1);t.dataset.bound="1",window.__CONTACT_FORM_DISABLED__=!1}catch(e){return window.__CONTACT_FORM_DISABLED__=!0,void console.warn("[contact-form guard] error:",e)}}(),window.__CONTACT_FORM_DISABLED__)return;const o=document.querySelector(".contact-form");o&&!o.dataset.bound&&(o.dataset.bound="1",o.addEventListener("submit",async function(e){e.preventDefault();const t=o.querySelector('button[type="submit"]')||o.querySelector(".btn-primary"),n=t?t.textContent:"Skicka meddelande";t&&(t.disabled=!0,t.textContent="Skickar...");try{const e=o.querySelector("#contact-name")||o.querySelector('input[name="name"]'),n=o.querySelector("#contact-email")||o.querySelector('input[name="email"]'),r=o.querySelector("#contact-phone")||o.querySelector('input[name="phone"]'),i=o.querySelector("#contact-message")||o.querySelector('textarea[name="message"]'),a=e?e.value.trim().replace(/\s+/g," "):"",s=n?n.value.trim():"",d=r?r.value.trim():"",c=i?i.value.trim().replace(/\s+/g," "):"";if(!a||a.length<2)return window.Utils&&window.Utils.showFormMessage("⚠ Ange ditt namn (minst 2 tecken)","error"),e&&e.focus(),void(t&&(t.disabled=!1));if(a.length>40)return window.Utils&&window.Utils.showFormMessage("⚠ Namnet är för långt (max 40 tecken)","error"),e&&e.focus(),void(t&&(t.disabled=!1));if(!/^[\p{L}\p{M}\s.'-]+$/u.test(a))return window.Utils&&window.Utils.showFormMessage("⚠ Namnet får bara innehålla bokstäver, mellanslag, apostrof och bindestreck","error"),e&&e.focus(),void(t&&(t.disabled=!1));if(!s||s.length<5)return window.Utils&&window.Utils.showFormMessage("⚠ E-postadressen är för kort (minst 5 tecken)","error"),n&&n.focus(),void(t&&(t.disabled=!1));if(s.length>254)return window.Utils&&window.Utils.showFormMessage("⚠ E-postadressen är för lång (max 254 tecken)","error"),n&&n.focus(),void(t&&(t.disabled=!1));if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return window.Utils&&window.Utils.showFormMessage("⚠ Ange en giltig e-postadress","error"),n&&n.focus(),void(t&&(t.disabled=!1));if(!c||c.length<10)return window.Utils&&window.Utils.showFormMessage("⚠ Meddelandet är för kort (minst 10 tecken)","error"),i&&i.focus(),void(t&&(t.disabled=!1));if(c.length>1e3)return window.Utils&&window.Utils.showFormMessage("⚠ Meddelandet är för längt (max 1000 tecken)","error"),i&&i.focus(),void(t&&(t.disabled=!1));const l={name:a,email:s,phone:d,message:c};if(!window.API_BASE_URL)return console.error("API_BASE_URL not configured for contact form!"),void(window.Utils&&window.Utils.showFormMessage("Konfigurationsfel. Försök igen om en stund.","error"));const u=await fetch(`${window.API_BASE_URL}/contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),w=await u.json();if(w.success){const e=w.message&&"string"==typeof w.message?w.message:"Tack för ditt meddelande! Vi hör av oss snart.";window.Utils&&window.Utils.showFormMessage(e,"success"),o.reset()}else{const e=w.error&&"string"==typeof w.error?w.error:"Ett fel uppstod. Försök igen.";window.Utils&&window.Utils.showFormMessage(e,"error")}}catch(e){console.error("Error submitting form:",e),window.Utils&&window.Utils.showFormMessage("Ett fel uppstod. Kontrollera din internetanslutning och försök igen.","error")}finally{t&&(t.disabled=!1,t.textContent=n)}}));const n=document.querySelector("#chatbot-popup form");n&&n.addEventListener("submit",function(e){e.preventDefault(),window.Utils&&window.Utils.showFormMessage("Tack! Vi hör av oss snart för att boka din demo.","success"),document.getElementById("chatbot-popup").classList.remove("active")})});